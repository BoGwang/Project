<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.koitt.board.dao.ReservationDaoImpl">

	<insert id="insert" parameterType="Reservation">
		<selectKey keyProperty="rno" resultType="Integer" order="BEFORE">
			SELECT reservation_seq.NEXTVAL rno FROM DUAL
		</selectKey>
		INSERT INTO reservation (rno, mno, mscr, rdate, id, mposter)
		VALUES (#{rno}, #{mno}, #{mscr}, #{rdate}, #{id}, #{mposter})
	</insert>

	<resultMap type="Reservation" id="reservationResultMap">
		<id property="rno" column="rno" />
		<result property="mno" column="mno" />
		<result property="mscr" column="mscr" />
		<result property="rdate" column="rdate" />
		<result property="id" column="id" />
		<result property="mposter" column="mposter" />
	</resultMap>

   <select id="select" parameterType="String" resultMap="reservationResultMap">
       SELECT r.rno, m.mno, r.scr, r.rdate, u.id , m.mposter
       FROM movie m, user_info u, reservation r
       WHERE r.id = u.id AND rno = #{rno}
      </select>
      
      <select id="selectAll" resultMap="reservationResultMap">
          SELECT r.rno, m.mno, r.scr, r.rdate, u.id , m.mposter
          FROM movie m, user_info u, reservation r
          WHERE r.id = u.id ORDER BY r.rno DESC
           </select>
                   

		<delete id="delete" parameterType="String">
		   DELETE FROM reservation WHERE rno = #{rno}
				</delete>


</mapper>